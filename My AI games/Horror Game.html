<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>2D Horror Game</title>
		<style>
			html,
			body {
				margin: 0;
				padding: 0;
				overflow: hidden;
				background: black;
			}
			canvas {
				display: block;
				background: #111;
				margin: 0 auto;
			}
		</style>
	</head>
	<body>
		<canvas id="game"></canvas>
		<script>
			const canvas = document.getElementById("game");
			const ctx = canvas.getContext("2d");
			canvas.width = 800;
			canvas.height = 600;

			// Game Variables
			const tileSize = 40;
			const mapWidth = 20;
			const mapHeight = 15;

			let player = { x: 1, y: 1, radius: 10 };
			let enemy = { x: 18, y: 13, dirX: -1, dirY: 0 };
			let flashlightBattery = 100;
			let keys = {};
			let gameOver = false;

			// Generate simple map (0 = empty, 1 = wall)
			let map = [];
			for (let y = 0; y < mapHeight; y++) {
				map[y] = [];
				for (let x = 0; x < mapWidth; x++) {
					if (
						x === 0 ||
						y === 0 ||
						x === mapWidth - 1 ||
						y === mapHeight - 1 ||
						Math.random() < 0.1
					) {
						map[y][x] = 1;
					} else {
						map[y][x] = 0;
					}
				}
			}

			// Key controls
			window.addEventListener("keydown", (e) => (keys[e.key] = true));
			window.addEventListener("keyup", (e) => (keys[e.key] = false));

			function update() {
				if (gameOver) return;

				// Player Movement
				let speed = 0.1;
				let dx = 0,
					dy = 0;
				if (keys["ArrowUp"] || keys["w"]) dy = -speed;
				if (keys["ArrowDown"] || keys["s"]) dy = speed;
				if (keys["ArrowLeft"] || keys["a"]) dx = -speed;
				if (keys["ArrowRight"] || keys["d"]) dx = speed;

				// Check collisions
				let newX = player.x + dx;
				let newY = player.y + dy;
				if (map[Math.floor(player.y)][Math.floor(newX)] === 0)
					player.x = newX;
				if (map[Math.floor(newY)][Math.floor(player.x)] === 0)
					player.y = newY;

				// Flashlight drains
				flashlightBattery -= 0.02;
				if (flashlightBattery <= 0) flashlightBattery = 0;

				// Enemy patrol (simple AI)
				enemy.x += enemy.dirX * 0.05;
				enemy.y += enemy.dirY * 0.05;
				if (map[Math.floor(enemy.y)][Math.floor(enemy.x)] === 1) {
					enemy.dirX *= -1;
					enemy.dirY *= -1;
				}

				// Check collision with enemy
				let dist = Math.hypot(player.x - enemy.x, player.y - enemy.y);
				if (dist < 0.5) gameOver = true;
			}

			function draw() {
				ctx.clearRect(0, 0, canvas.width, canvas.height);

				// Draw map
				for (let y = 0; y < mapHeight; y++) {
					for (let x = 0; x < mapWidth; x++) {
						if (map[y][x] === 1) {
							ctx.fillStyle = "#333";
							ctx.fillRect(
								x * tileSize,
								y * tileSize,
								tileSize,
								tileSize
							);
						}
					}
				}

				// Darkness overlay
				ctx.fillStyle = "rgba(0,0,0,0.9)";
				ctx.fillRect(0, 0, canvas.width, canvas.height);

				// Flashlight cone
				ctx.save();
				ctx.beginPath();
				let px = player.x * tileSize + tileSize / 2;
				let py = player.y * tileSize + tileSize / 2;
				ctx.arc(px, py, 150, 0, Math.PI * 2);
				ctx.clip();

				// Draw player
				ctx.fillStyle = "white";
				ctx.beginPath();
				ctx.arc(px, py, player.radius, 0, Math.PI * 2);
				ctx.fill();

				// Draw enemy
				ctx.fillStyle = "red";
				ctx.beginPath();
				ctx.arc(
					enemy.x * tileSize + tileSize / 2,
					enemy.y * tileSize + tileSize / 2,
					10,
					0,
					Math.PI * 2
				);
				ctx.fill();

				ctx.restore();

				// Battery bar
				ctx.fillStyle = "gray";
				ctx.fillRect(20, 20, 200, 20);
				ctx.fillStyle = "yellow";
				ctx.fillRect(20, 20, 2 * flashlightBattery, 20);

				// Game over
				if (gameOver) {
					ctx.fillStyle = "red";
					ctx.font = "50px sans-serif";
					ctx.fillText(
						"YOU DIED",
						canvas.width / 2 - 120,
						canvas.height / 2
					);
				}
			}

			function loop() {
				update();
				draw();
				requestAnimationFrame(loop);
			}

			loop();
		</script>
	</body>
</html>
