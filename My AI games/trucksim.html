<!DOCTYPE html>
<html>
	<head>
		<title>American Trucker</title>
		<style>
			body {
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				height: 100vh;
				margin: 0;
				background-color: #2c3e50; /* Dark blue-grey for a sunset feel */
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				color: white;
				text-align: center;
			}
			canvas {
				background-color: #34495e; /* Slightly darker road color */
				border: 5px solid #bdc3c7; /* Silver border for a metallic look */
				border-radius: 10px;
				box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
			}
			h1 {
				font-size: 2.5em;
				text-shadow: 2px 2px 4px #000;
			}
			.controls {
				margin-top: 20px;
				font-size: 1.2em;
			}
			.controls span {
				display: inline-block;
				margin: 0 10px;
				padding: 5px 10px;
				background-color: #34495e;
				border: 2px solid #ecf0f1;
				border-radius: 5px;
			}
		</style>
	</head>
	<body>
		<div>
			<h1>American Trucker</h1>
			<canvas id="gameCanvas" width="400" height="600"></canvas>
			<div class="controls">
				<p>
					Controls: <br />
					<span>A/D</span> - Steer | <span>W</span> - Nitro Boost |
					<span>S</span> - Brake | <span>Spacebar</span> - Invincible
					Rush
				</p>
			</div>
		</div>
		<script>
			const canvas = document.getElementById("gameCanvas");
			const ctx = canvas.getContext("2d");

			const ROAD_WIDTH = 300;
			const LANE_WIDTH = ROAD_WIDTH / 3;
			const CAR_WIDTH = 60; // Make player wider to look more like a truck
			const CAR_HEIGHT = 90; // Make player taller
			const PEDESTRIAN_WIDTH = 20; // Smaller size for pedestrians
			const PEDESTRIAN_HEIGHT = 30; // Smaller size for pedestrians
			const NORMAL_ROAD_SPEED = 10;
			const BOOST_ROAD_SPEED = 50;
			const SLOW_ROAD_SPEED = 4;
			const PLAYER_SPEED = 5;
			const SPACEBAR_BOOST_SPEED = 500;

			let ROAD_SPEED = NORMAL_ROAD_SPEED;
			let isInvincible = false;
			let invincibilityTimerId = null;

			let player = {
				x: canvas.width / 2 - CAR_WIDTH / 2,
				y: canvas.height - CAR_HEIGHT - 20,
				width: CAR_WIDTH,
				height: CAR_HEIGHT,
				speedX: 0,
				color: "#e74c3c", // Red truck color
			};

			let otherCars = [];
			let pedestrians = []; // New array for pedestrians
			let powerUps = [];
			let score = 0;
			let gameOver = false;
			let isPaused = false;
			let animationFrameId;

			document.addEventListener("keydown", (e) => {
				if (e.key === "Escape") {
					togglePause();
				}

				if (!gameOver && !isPaused) {
					if (e.key.toLowerCase() === "a") {
						player.speedX = -PLAYER_SPEED;
					} else if (e.key.toLowerCase() === "d") {
						player.speedX = PLAYER_SPEED;
					} else if (e.key.toLowerCase() === "w") {
						ROAD_SPEED = BOOST_ROAD_SPEED;
					} else if (e.key.toLowerCase() === "s") {
						ROAD_SPEED = SLOW_ROAD_SPEED;
					} else if (e.key === " ") {
						e.preventDefault();
						ROAD_SPEED = SPACEBAR_BOOST_SPEED;
						activateInvincibility();
					}
				}
				if (e.key.toLowerCase() === "r" && gameOver) {
					restartGame();
				}
			});

			document.addEventListener("keyup", (e) => {
				if (!isPaused) {
					if (
						e.key.toLowerCase() === "a" ||
						e.key.toLowerCase() === "d"
					) {
						player.speedX = 0;
					} else if (
						e.key.toLowerCase() === "w" ||
						e.key.toLowerCase() === "s"
					) {
						ROAD_SPEED = NORMAL_ROAD_SPEED;
					} else if (e.key === " ") {
						ROAD_SPEED = NORMAL_ROAD_SPEED;
					}
				}
			});

			function drawPlayer() {
				if (isInvincible) {
					// Flashing effect for invincibility
					if (Math.floor(Date.now() / 100) % 2 === 0) {
						ctx.fillStyle = player.color;
					} else {
						ctx.fillStyle = "#fff"; // White flash
					}
				} else {
					ctx.fillStyle = player.color;
				}
				ctx.fillRect(player.x, player.y, player.width, player.height);

				// Draw a trailer to make it look like a truck
				ctx.fillStyle = "#95a5a6"; // Grey trailer color
				ctx.fillRect(
					player.x - 5,
					player.y + player.height,
					player.width + 10,
					player.height * 1.5
				);
			}

			function drawOtherCars() {
				otherCars.forEach((car) => {
					ctx.fillStyle = car.color;
					ctx.fillRect(car.x, car.y, car.width, car.height);
				});
			}

			function drawPedestrians() {
				pedestrians.forEach((pedestrian) => {
					ctx.fillStyle = pedestrian.color;
					ctx.fillRect(
						pedestrian.x,
						pedestrian.y,
						pedestrian.width,
						pedestrian.height
					);
				});
			}

			function drawPowerUps() {
				powerUps.forEach((powerUp) => {
					// Draw a star shape for the power-up
					const centerX = powerUp.x + powerUp.width / 2;
					const centerY = powerUp.y + powerUp.height / 2;
					const outerRadius = powerUp.width / 2;
					const innerRadius = outerRadius / 2;
					const numPoints = 5;

					ctx.fillStyle = "#f1c40f"; // Yellow star
					ctx.beginPath();
					for (let i = 0; i < numPoints * 2; i++) {
						const radius = i % 2 === 0 ? outerRadius : innerRadius;
						const angle = (Math.PI / numPoints) * i;
						const x = centerX + radius * Math.sin(angle);
						const y = centerY + radius * Math.cos(angle);
						ctx.lineTo(x, y);
					}
					ctx.closePath();
					ctx.fill();
				});
			}

			function updatePlayer() {
				player.x += player.speedX;
				const roadLeft = (canvas.width - ROAD_WIDTH) / 2;
				const roadRight = (canvas.width + ROAD_WIDTH) / 2;
				if (player.x < roadLeft) {
					player.x = roadLeft;
				}
				if (player.x + player.width > roadRight) {
					player.x = roadRight - player.width;
				}
			}

			function updateOtherCars() {
				for (let i = 0; i < otherCars.length; i++) {
					const car = otherCars[i];
					car.y += ROAD_SPEED;

					if (car.isSwerving) {
						const swerveSpeed = 10;
						car.x += swerveSpeed * Math.sin(car.swerveTime);
						car.swerveTime += 25;
					}
				}

				if (Math.random() < 0.02 * (ROAD_SPEED / NORMAL_ROAD_SPEED)) {
					const lane = Math.floor(Math.random() * 3);
					const x =
						(canvas.width - ROAD_WIDTH) / 2 +
						lane * LANE_WIDTH +
						(LANE_WIDTH - CAR_WIDTH) / 2;
					const colors = ["#c0392b", "#27ae60", "#2980b9", "#f39c12"];
					const color =
						colors[Math.floor(Math.random() * colors.length)];
					const isSwerving = Math.random() < 0.3;
					otherCars.push({
						x,
						y: -CAR_HEIGHT,
						width: CAR_WIDTH,
						height: CAR_HEIGHT,
						color,
						isSwerving,
						swerveTime: isSwerving
							? Math.random() * 2 * Math.PI
							: 0,
					});
				}

				otherCars = otherCars.filter((car) => car.y < canvas.height);
			}

			function updatePedestrians() {
				for (let i = 0; i < pedestrians.length; i++) {
					const pedestrian = pedestrians[i];
					pedestrian.y += ROAD_SPEED;
				}

				// Spawn a new pedestrian randomly
				if (Math.random() < 0.005 * (ROAD_SPEED / NORMAL_ROAD_SPEED)) {
					const lane = Math.floor(Math.random() * 3);
					const x =
						(canvas.width - ROAD_WIDTH) / 2 +
						lane * LANE_WIDTH +
						(LANE_WIDTH - PEDESTRIAN_WIDTH) / 2;
					pedestrians.push({
						x,
						y: -PEDESTRIAN_HEIGHT,
						width: PEDESTRIAN_WIDTH,
						height: PEDESTRIAN_HEIGHT,
						color: "#3498db", // Blue color for pedestrians
					});
				}

				pedestrians = pedestrians.filter((p) => p.y < canvas.height);
			}

			function updatePowerUps() {
				for (let i = 0; i < powerUps.length; i++) {
					powerUps[i].y += ROAD_SPEED;
				}

				if (Math.random() < 0.005) {
					const lane = Math.floor(Math.random() * 3);
					const x =
						(canvas.width - ROAD_WIDTH) / 2 +
						lane * LANE_WIDTH +
						(LANE_WIDTH - CAR_WIDTH) / 2;
					powerUps.push({
						x,
						y: -CAR_HEIGHT,
						width: CAR_WIDTH,
						height: CAR_HEIGHT,
					});
				}

				powerUps = powerUps.filter(
					(powerUp) => powerUp.y < canvas.height
				);
			}

			function checkPowerUpCollision() {
				for (let i = powerUps.length - 1; i >= 0; i--) {
					const powerUp = powerUps[i];
					const playerCenterX = player.x + player.width / 2;
					const playerCenterY = player.y + player.height / 2;
					const powerUpCenterX = powerUp.x + powerUp.width / 2;
					const powerUpCenterY = powerUp.y + powerUp.height / 2;
					const dx = playerCenterX - powerUpCenterX;
					const dy = playerCenterY - powerUpCenterY;
					const distance = Math.sqrt(dx * dx + dy * dy);

					if (distance < powerUp.width / 2 + player.width / 2) {
						activateInvincibility();
						powerUps.splice(i, 1);
					}
				}
			}

			function checkPedestrianCollision() {
				if (isInvincible) {
					// Remove the pedestrian but don't end the game if invincible
					pedestrians = pedestrians.filter((pedestrian) => {
						if (
							player.x < pedestrian.x + pedestrian.width &&
							player.x + player.width > pedestrian.x &&
							player.y < pedestrian.y + pedestrian.height &&
							player.y + player.height > pedestrian.y
						) {
							score += 1000; // Add 1000 to the score
							return false; // Remove the pedestrian from the array
						}
						return true;
					});
					return;
				}

				// Normal collision: check and filter out hit pedestrians
				let hitPedestrian = false;
				pedestrians = pedestrians.filter((pedestrian) => {
					if (
						player.x < pedestrian.x + pedestrian.width &&
						player.x + player.width > pedestrian.x &&
						player.y < pedestrian.y + pedestrian.height &&
						player.y + player.height > pedestrian.y
					) {
						score += 1000; // Add 1000 to the score
						hitPedestrian = true;
						return false; // Remove the pedestrian from the array
					}
					return true;
				});

				// If any pedestrian was hit, the game is not over, but the score is updated
				if (hitPedestrian) {
					// A special effect could be added here
				}
			}

			function activateInvincibility() {
				if (invincibilityTimerId) {
					clearTimeout(invincibilityTimerId);
				}
				isInvincible = true;
				invincibilityTimerId = setTimeout(() => {
					isInvincible = false;
					invincibilityTimerId = null;
				}, 4000);
			}

			function checkCollision() {
				if (isInvincible) {
					return;
				}
				otherCars.forEach((car) => {
					if (
						player.x < car.x + car.width &&
						player.x + player.width > car.x &&
						player.y < car.y + car.height &&
						player.y + player.height > car.y
					) {
						gameOver = true;
					}
				});
			}

			function drawRoad() {
				ctx.fillStyle = "#555";
				const roadLeft = (canvas.width - ROAD_WIDTH) / 2;
				ctx.fillRect(roadLeft, 0, ROAD_WIDTH, canvas.height);

				// Draw lane lines
				ctx.strokeStyle = "white";
				ctx.lineWidth = 5;
				ctx.setLineDash([20, 20]);
				ctx.beginPath();
				ctx.moveTo(canvas.width / 2, 0);
				ctx.lineTo(canvas.width / 2, canvas.height);
				ctx.stroke();

				// Draw road sides
				ctx.fillStyle = "#424242";
				ctx.fillRect(
					0,
					0,
					(canvas.width - ROAD_WIDTH) / 2,
					canvas.height
				);
				ctx.fillRect(
					(canvas.width + ROAD_WIDTH) / 2,
					0,
					(canvas.width - ROAD_WIDTH) / 2,
					canvas.height
				);
			}

			function drawScore() {
				ctx.fillStyle = "white";
				ctx.font = "24px Arial";
				ctx.fillText("Score: " + score, 10, 30);
				if (isInvincible) {
					ctx.fillStyle = "yellow";
					ctx.fillText("INVINCIBLE", 10, 60);
				}
			}

			function drawGameOver() {
				ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
				ctx.fillRect(0, 0, canvas.width, canvas.height);
				ctx.fillStyle = "red";
				ctx.font = "40px Arial";
				ctx.fillText(
					"GAME OVER",
					canvas.width / 2 - 100,
					canvas.height / 2
				);
				ctx.fillStyle = "white";
				ctx.font = "24px Arial";
				ctx.fillText(
					"Final Score: " + score,
					canvas.width / 2 - 80,
					canvas.height / 2 + 40
				);
				ctx.font = "18px Arial";
				ctx.fillText(
					"Press 'R' to Restart",
					canvas.width / 2 - 80,
					canvas.height / 2 + 80
				);
			}

			function drawPauseScreen() {
				ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
				ctx.fillRect(0, 0, canvas.width, canvas.height);
				ctx.fillStyle = "white";
				ctx.font = "40px Arial";
				ctx.fillText(
					"PAUSED",
					canvas.width / 2 - 70,
					canvas.height / 2
				);
				ctx.font = "24px Arial";
				ctx.fillText(
					"Press 'ESC' to continue",
					canvas.width / 2 - 120,
					canvas.height / 2 + 40
				);
			}

			function togglePause() {
				isPaused = !isPaused;
				if (!isPaused) {
					animate();
				}
			}

			function update() {
				updatePlayer();
				updateOtherCars();
				updatePedestrians();
				updatePowerUps();
				checkCollision();
				checkPedestrianCollision();
				checkPowerUpCollision();
				score++;
			}

			function draw() {
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				drawRoad();
				drawOtherCars();
				drawPedestrians();
				drawPowerUps();
				drawPlayer();
				drawScore();
			}

			function animate() {
				if (gameOver) {
					drawGameOver();
					return;
				}
				if (isPaused) {
					drawPauseScreen();
					return;
				}
				update();
				draw();
				animationFrameId = requestAnimationFrame(animate);
			}

			function restartGame() {
				player.x = canvas.width / 2 - CAR_WIDTH / 2;
				player.y = canvas.height - CAR_HEIGHT - 20;
				player.speedX = 0;
				otherCars = [];
				pedestrians = [];
				powerUps = [];
				score = 0;
				ROAD_SPEED = NORMAL_ROAD_SPEED;
				gameOver = false;
				isInvincible = false;
				if (invincibilityTimerId) {
					clearTimeout(invincibilityTimerId);
					invincibilityTimerId = null;
				}
				animate();
			}

			animate();
		</script>
	</body>
</html>
