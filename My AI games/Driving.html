<!DOCTYPE html>
<html>
	<head>
		<title>Driving Game</title>
		<style>
			body {
				display: flex;
				justify-content: center;
				align-items: center;
				height: 100vh;
				margin: 0;
				background-color: #333;
				font-family: sans-serif;
				color: white;
				text-align: center;
			}
			canvas {
				background-color: #555;
				border: 2px solid white;
			}
		</style>
	</head>
	<body>
		<div>
			<h1>Simple Driving Game</h1>
			<canvas id="gameCanvas" width="400" height="600"></canvas>
		</div>
		<script>
			const canvas = document.getElementById("gameCanvas");
			const ctx = canvas.getContext("2d");

			const NUM_LANES = 5;
			let ROAD_WIDTH = canvas.width;
			let LANE_WIDTH = ROAD_WIDTH / NUM_LANES;
			let CAR_WIDTH = LANE_WIDTH * 0.8;
			const CAR_HEIGHT = 60;
			const NORMAL_ROAD_SPEED = 10;
			const BOOST_ROAD_SPEED = 50;
			const SLOW_ROAD_SPEED = 4;
			const PLAYER_SPEED = 5;

			let ROAD_SPEED = NORMAL_ROAD_SPEED;
			let isInvincible = false;
			let invincibilityTimerId = null;

			let player = {
				x: canvas.width / 2 - CAR_WIDTH / 2,
				y: canvas.height - CAR_HEIGHT - 20,
				width: CAR_WIDTH,
				height: CAR_HEIGHT,
				speedX: 0,
				color: "blue",
				rotation: 0, // Player faces up (0 degrees)
			};

			let otherCars = [];
			let powerUps = [];
			let score = 0;
			let gameOver = false;
			let isPaused = false;
			let animationFrameId;

			function resizeCanvas() {
				canvas.width = window.innerWidth * 0.9;
				canvas.height = window.innerHeight * 0.9;
				ROAD_WIDTH = canvas.width;
				LANE_WIDTH = ROAD_WIDTH / NUM_LANES;
				CAR_WIDTH = LANE_WIDTH * 0.8;
				player.x = canvas.width / 2 - CAR_WIDTH / 2;
				player.width = CAR_WIDTH;
			}

			window.addEventListener("resize", resizeCanvas);
			resizeCanvas();

			document.addEventListener("keydown", (e) => {
				if (e.key === "Escape") {
					togglePause();
				}

				if (!gameOver && !isPaused) {
					if (e.key.toLowerCase() === "a") {
						player.speedX = -PLAYER_SPEED;
					} else if (e.key.toLowerCase() === "d") {
						player.speedX = PLAYER_SPEED;
					} else if (e.key.toLowerCase() === "w") {
						ROAD_SPEED = BOOST_ROAD_SPEED;
					} else if (e.key.toLowerCase() === "s") {
						ROAD_SPEED = SLOW_ROAD_SPEED;
					}
				}
				if (e.key.toLowerCase() === "r" && gameOver) {
					restartGame();
				}
			});

			document.addEventListener("keyup", (e) => {
				if (!isPaused) {
					if (
						e.key.toLowerCase() === "a" ||
						e.key.toLowerCase() === "d"
					) {
						player.speedX = 0;
					} else if (
						e.key.toLowerCase() === "w" ||
						e.key.toLowerCase() === "s"
					) {
						ROAD_SPEED = NORMAL_ROAD_SPEED;
					}
				}
			});

			// Function to draw a car with more detail and rotation
			function drawCar(car, isPlayer) {
				const carColor = car.color;
				const wheelColor = "#111";
				const wheelRadius = car.width / 6;

				ctx.save();
				ctx.translate(car.x + car.width / 2, car.y + car.height / 2);
				ctx.rotate(car.rotation);

				// Draw wheels first (relative to the new origin)
				ctx.fillStyle = wheelColor;
				ctx.beginPath();
				// Back-left wheel
				ctx.arc(
					-(car.width / 2) + wheelRadius * 1.5,
					-(car.height / 2) + wheelRadius,
					wheelRadius,
					0,
					2 * Math.PI
				);
				// Back-right wheel
				ctx.arc(
					car.width / 2 - wheelRadius * 1.5,
					-(car.height / 2) + wheelRadius,
					wheelRadius,
					0,
					2 * Math.PI
				);
				// Front-left wheel
				ctx.arc(
					-(car.width / 2) + wheelRadius * 1.5,
					car.height / 2 - wheelRadius,
					wheelRadius,
					0,
					2 * Math.PI
				);
				// Front-right wheel
				ctx.arc(
					car.width / 2 - wheelRadius * 1.5,
					car.height / 2 - wheelRadius,
					wheelRadius,
					0,
					2 * Math.PI
				);
				ctx.fill();
				ctx.closePath();

				// Draw car body on top of the wheels
				ctx.fillStyle = carColor;
				const borderRadius = 5;
				ctx.beginPath();
				ctx.roundRect(
					-car.width / 2,
					-car.height / 2,
					car.width,
					car.height,
					borderRadius
				);
				ctx.fill();
				ctx.closePath();

				// Draw car roof/windows
				ctx.fillStyle = "#888";
				ctx.beginPath();
				const roofHeight = car.height * 0.4;
				const roofWidth = car.width * 0.7;
				const roofX = -(roofWidth / 2);
				const roofY = -(car.height / 2) + car.height * 0.15;
				ctx.roundRect(
					roofX,
					roofY,
					roofWidth,
					roofHeight,
					borderRadius
				);
				ctx.fill();
				ctx.closePath();

				// Add "Caution Student Driver" text to other cars
				if (!isPlayer) {
					ctx.fillStyle = "black";
					ctx.font = "bold 10px Arial";
					ctx.textAlign = "center";
					ctx.fillText("Caution", 0, 0 - 5);
					ctx.fillText("Student Driver", 0, 0 + 5);
					ctx.textAlign = "left";
				}

				ctx.restore();
			}

			function drawPlayer() {
				if (isInvincible) {
					if (Math.floor(Date.now() / 100) % 2 === 0) {
						player.color = "blue";
					} else {
						player.color = "white";
					}
				} else {
					player.color = "blue";
				}
				drawCar(player, true);
			}

			function drawOtherCars() {
				otherCars.forEach((car) => {
					drawCar(car, false);
				});
			}

			function drawPowerUps() {
				powerUps.forEach((powerUp) => {
					ctx.fillStyle = "white";
					ctx.beginPath();
					ctx.arc(
						powerUp.x + powerUp.width / 2,
						powerUp.y + powerUp.height / 2,
						powerUp.width / 2,
						0,
						2 * Math.PI
					);
					ctx.fill();
				});
			}

			function updatePlayer() {
				player.x += player.speedX;
				if (player.x < 0) {
					player.x = 0;
				}
				if (player.x + player.width > canvas.width) {
					player.x = canvas.width - player.width;
				}
			}

			function updateOtherCars() {
				for (let i = 0; i < otherCars.length; i++) {
					const car = otherCars[i];
					car.y += ROAD_SPEED;

					if (car.isSwerving) {
						const swerveSpeed = 5;
						car.x += swerveSpeed * Math.sin(car.swerveTime);
						car.swerveTime += 50;
					}
				}

				if (Math.random() < 0.02 * (ROAD_SPEED / NORMAL_ROAD_SPEED)) {
					const lane = Math.floor(Math.random() * NUM_LANES);
					const x = lane * LANE_WIDTH + (LANE_WIDTH - CAR_WIDTH) / 2;
					const colors = ["red", "yellow", "green"];
					const color =
						colors[Math.floor(Math.random() * colors.length)];
					const isSwerving = Math.random() < 0.3;
					otherCars.push({
						x,
						y: -CAR_HEIGHT,
						width: CAR_WIDTH,
						height: CAR_HEIGHT,
						color,
						isSwerving,
						swerveTime: isSwerving
							? Math.random() * 2 * Math.PI
							: 0,
						rotation: Math.PI, // Opponent cars face down (180 degrees)
					});
				}

				otherCars = otherCars.filter((car) => car.y < canvas.height);
			}

			function updatePowerUps() {
				for (let i = 0; i < powerUps.length; i++) {
					powerUps[i].y += ROAD_SPEED;
				}

				if (Math.random() < 0.005) {
					const lane = Math.floor(Math.random() * NUM_LANES);
					const x = lane * LANE_WIDTH + (LANE_WIDTH - CAR_WIDTH) / 2;
					powerUps.push({
						x,
						y: -CAR_HEIGHT,
						width: CAR_WIDTH,
						height: CAR_HEIGHT,
					});
				}

				powerUps = powerUps.filter(
					(powerUp) => powerUp.y < canvas.height
				);
			}

			function checkPowerUpCollision() {
				for (let i = powerUps.length - 1; i >= 0; i--) {
					const powerUp = powerUps[i];
					const playerCenterX = player.x + player.width / 2;
					const playerCenterY = player.y + player.height / 2;
					const powerUpCenterX = powerUp.x + powerUp.width / 2;
					const powerUpCenterY = powerUp.y + powerUp.height / 2;
					const dx = playerCenterX - powerUpCenterX;
					const dy = playerCenterY - powerUpCenterY;
					const distance = Math.sqrt(dx * dx + dy * dy);

					if (distance < powerUp.width / 2 + player.width / 2) {
						activateInvincibility();
						powerUps.splice(i, 1);
					}
				}
			}

			function activateInvincibility() {
				if (invincibilityTimerId) {
					clearTimeout(invincibilityTimerId);
				}
				isInvincible = true;
				invincibilityTimerId = setTimeout(() => {
					isInvincible = false;
					invincibilityTimerId = null;
				}, 15000);
			}

			function checkCollision() {
				if (isInvincible) {
					return;
				}
				otherCars.forEach((car) => {
					if (
						player.x < car.x + car.width &&
						player.x + player.width > car.x &&
						player.y < car.y + car.height &&
						player.y + player.height > car.y
					) {
						gameOver = true;
					}
				});
			}

			function drawScore() {
				ctx.fillStyle = "white";
				ctx.font = "24px Arial";
				ctx.fillText("Score: " + score, 10, 30);
				if (isInvincible) {
					ctx.fillStyle = "white";
					ctx.font = "20px Arial";
					ctx.fillText("INVINCIBLE", canvas.width - 150, 30);
				}
			}

			function drawGameOver() {
				ctx.fillStyle = "white";
				ctx.font = "40px Arial";
				ctx.textAlign = "center";
				ctx.fillText("Game Over!", canvas.width / 2, canvas.height / 2);
				ctx.font = "20px Arial";
				ctx.fillText(
					'Press "R" to Restart',
					canvas.width / 2,
					canvas.height / 2 + 40
				);
				ctx.textAlign = "left";
			}

			function drawPauseMessage() {
				ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
				ctx.fillRect(0, 0, canvas.width, canvas.height);
				ctx.fillStyle = "white";
				ctx.font = "40px Arial";
				ctx.textAlign = "center";
				ctx.fillText(
					"Your game is Paused",
					canvas.width / 2,
					canvas.height / 2
				);
				ctx.textAlign = "left";
			}

			function updateGame() {
				if (!gameOver) {
					updatePlayer();
					updateOtherCars();
					updatePowerUps();
					checkPowerUpCollision();
					checkCollision();
					score++;
				}
			}

			function drawGame() {
				ctx.clearRect(0, 0, canvas.width, canvas.height);

				ctx.fillStyle = "#444";
				ctx.fillRect(0, 0, canvas.width, canvas.height);

				ctx.fillStyle = "white";
				for (let lane = 1; lane < NUM_LANES; lane++) {
					for (let i = 0; i < 6; i++) {
						const lineY =
							(i * 100 + ((score * (ROAD_SPEED * 0.2)) % 200)) %
							canvas.height;
						ctx.fillRect(lane * LANE_WIDTH - 2.5, lineY, 5, 50);
					}
				}

				drawPlayer();
				drawOtherCars();
				drawPowerUps();
				drawScore();

				if (gameOver) {
					drawGameOver();
				}
			}

			function gameLoop() {
				if (!isPaused) {
					updateGame();
					drawGame();
				} else {
					drawPauseMessage();
				}

				animationFrameId = requestAnimationFrame(gameLoop);
			}

			function togglePause() {
				isPaused = !isPaused;
			}

			function restartGame() {
				gameOver = false;
				score = 0;
				otherCars = [];
				powerUps = [];
				player.x = canvas.width / 2 - CAR_WIDTH / 2;
				player.speedX = 0;
				ROAD_SPEED = NORMAL_ROAD_SPEED;
				isInvincible = false;
				if (invincibilityTimerId) {
					clearTimeout(invincibilityTimerId);
					invincibilityTimerId = null;
				}
			}

			gameLoop();
		</script>
	</body>
</html>
